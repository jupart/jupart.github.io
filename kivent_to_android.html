<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="jupart" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="Setting up to deploy Kivent to Android"/>
    <meta property="og:url" content="/kivent_to_android.html"/>
    <meta property="og:site_name" content="jupart"/>
    <meta property="og:type" content="article"/>

    <link rel="canonical" href="/kivent_to_android.html" />

    <title>Setting up to deploy Kivent to Android | jupart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="/theme/css/main.css" />


    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>

</head>

<body id="index">
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="/">jupart </a>
                </h1>
                <!-- <nav class="navbar"> -->
                <!--     <div class="navbar-inner"> -->
                <!--         <ul class="nav"> -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--          -->
                <!--             <li ><a href="/category/game.html">game</a></li> -->
                <!--          -->
                <!--             <li class="active"><a href="/category/tutorial.html">tutorial</a></li> -->
                <!--          -->
                <!--          -->
                <!--         </ul> -->

                <!--          -->
                <!--     </div> -->
                <!-- </nav> -->
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="/kivent_to_android.html" rel="bookmark"
             title="Permalink to Setting up to deploy Kivent to Android">Setting up to deploy Kivent to Android</a></h1>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <!--  -->
    <!-- <address class="vcard author"> -->
    <!--     by <a class="url fn" href="/author/jupart.html">jupart</a> -->
    <!-- </address> -->
    <!--  -->

    <!-- in <a href="/category/tutorial.html">tutorial</a> -->

    2017-08-03

    <!--  -->
    <!--     | -->
    <!--     tags:  -->
    <!--     <a href="/tag/kivent.html">kivent</a> -->
    <!--      -->
    <!--     <a href="/tag/python.html">python</a> -->
    <!--      -->
    <!--     <a href="/tag/buildozer.html">buildozer</a> -->
    <!--      -->
    <!--     <a href="/tag/kivy.html">kivy</a> -->
    <!--      -->
    <!--     <a href="/tag/android.html">android</a> -->
    <!--      -->
    <!--     <a href="/tag/cymunk.html">cymunk</a> -->
    <!--      -->
    <!--  -->



    
</footer><!-- /.post-info -->

        <p>I recently put together a new machine and needed to get my python toolchain
back up and running, so I decided to record the needed steps and post them
here.</p>
<p>This post assumes your requirements are the same as mine, that your goal is to deploy apps
that make use of Python 2.7, Kivy, Kivent's core, and Kivent's physics module (via Cymunk
via Chipmunk2D) to Android.</p>
<p>I use Debian-based Linux distributions, like Ubuntu, so my dependencies will be installed
via <tt class="docutils literal">apt</tt>. My workflow is to write the core of my app, run and test on my
desktop/laptop machine, and then begin to deploy to my Android device for
testing and improvements.</p>
<p>First, lets make sure we have <tt class="docutils literal">pip</tt>, <tt class="docutils literal">kivy</tt>'s dependencies, and <tt class="docutils literal">virtualenv</tt>,
which we use to house our python modules used for development for our project.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> sudo apt install python-pip build-essential git python python-dev ffmpeg libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev libportmidi-dev libswscale-dev libavformat-dev libavcodec-dev zlib1g-dev
<span class="gp">$</span> sudo pip install virtualenv
</pre></div>
<p>After we've set up and <tt class="docutils literal">source</tt>'d our <tt class="docutils literal">virtualenv</tt>, we can install
<tt class="docutils literal">cython</tt> and then <tt class="docutils literal">kivy</tt>.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> project_path
<span class="gp">$</span> virtualenv project_env
<span class="gp">$</span> <span class="nb">source</span> project_path/project_env/bin/activate
<span class="gp">(project_env) $</span> pip install cython kivy
</pre></div>
<p><tt class="docutils literal">kivent</tt> and <tt class="docutils literal">cymunk</tt> are not installable via pip at the time of this writing, so next,
we need to clone their repositories off of github into a local folder (I typically store my
tools in ~/Tools). We'll run their respective <tt class="docutils literal">setup.py</tt>'s using <tt class="docutils literal">python</tt> specific to
the <tt class="docutils literal">virtualenv</tt> we just created.</p>
<p>Note that <tt class="docutils literal">kivent</tt> contains several modules (core, cymunk, particles, etc.), so you'll
want to install the ones you need for your project. I'm only using kivent_core
and kivent_cymunk. You may be wondering why you need to install <tt class="docutils literal">cymunk</tt> and
<tt class="docutils literal">kivent_cymunk</tt>. This is because <tt class="docutils literal">cymunk</tt> is a module that supplies python
bindings to a C-based library called Chipmunk2D. <tt class="docutils literal">kivent_cymunk</tt> builds on
that by adding a game system you can use to apply physics to your entities.</p>
<div class="highlight"><pre><span></span><span class="gp">(project_env) $</span> <span class="nb">cd</span> ~/Tools
<span class="gp">(project_env) $</span> git clone https://github.com/kivy/kivent.git
<span class="gp">(project_env) $</span> git clone https://github.com/tito/cymunk

<span class="gp">(project_env) $</span> <span class="nb">cd</span> cymunk
<span class="gp">(project_env) $</span> python setup.py build_ext install

<span class="gp">(project_env) $</span> <span class="nb">cd</span> ../kivent/modules/core
<span class="gp">(project_env) $</span> python setup.py build_ext install

<span class="gp">(project_env) $</span> <span class="nb">cd</span> ../cymunk
<span class="gp">(project_env) $</span> python setup.py build_ext install
</pre></div>
<p>At this point, we can run our code and test on our desktop/laptop machines as
needed. To deploy to our Android device, we'll need a tool called
<tt class="docutils literal">buildozer</tt>.</p>
<p>Note that <tt class="docutils literal">buildozer</tt> is installed system-wide. It has nothing to do with
your modules we've installed up til now. <tt class="docutils literal">buildozer</tt> reads your
<tt class="docutils literal">buildozer.spec</tt> in your project's root directory and downloads the modules
and tools it needs based on the information contained in it.</p>
<div class="highlight"><pre><span></span><span class="gp">(project_env) $</span> deactivate

<span class="gp">$</span> sudo pip install cython
<span class="gp">$</span> sudo pip install buildozer
</pre></div>
<p>In order to build your project, it needs a Java compiler. Normally, we'd use
<tt class="docutils literal">openjdk</tt> for this, but the Android SDK that <tt class="docutils literal">buildozer</tt> downloads uses
source version 1.5, which is deprecated and <tt class="docutils literal">openjdk</tt> won't compile it. So
instead, lets get Oracle's jdk, which complains, but will compile.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> sudo add-apt-repository ppa:webupd8team/java
<span class="gp">$</span> sudo apt update
<span class="gp">$</span> sudo apt install oracle-java8-installer
</pre></div>
<p>Next, grab the 32-bit libraries <tt class="docutils literal">buildozer</tt> requires.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> sudo apt-get install build-essential ccache git libncurses5:i386 libstdc++6:i386 libgtk2.0-0:i386 libpangox-1.0-0:i386 libpangoxft-1.0-0:i386 libidn11:i386 python2.7 python2.7-dev unzip zlib1g-dev zlib1g:i386
</pre></div>
<p>We need to add udev rules specific to your device. This lets you deploy
your app to your Android device.  Find your device id by typing <tt class="docutils literal">lsusb</tt> into
your terminal with your Android device plugged in via USB. If you run the command
before and after plugging in your device, you should notice your device in the
difference between the two. My device in <tt class="docutils literal">lusb</tt> looks like this:</p>
<div class="highlight"><pre><span></span><span class="go">Bus 001 Device 003: ID 18d1:4ee7 Google Inc.</span>
</pre></div>
<p>You need to add a line to <tt class="docutils literal"><span class="pre">/etc/udev/rules.d/51-android.rules</span></tt> (and create that
file if it doesn't already exist) resembling the following:</p>
<div class="highlight"><pre><span></span><span class="go">SUBSYSTEM==&quot;usb&quot;, ATTR{idVendor}==&quot;18d1&quot;, MODE=&quot;0666&quot;, GROUP=&quot;plugdev&quot;</span>
</pre></div>
<p>where <tt class="docutils literal">18d1</tt> is your device's idVendor (mine was <tt class="docutils literal">18d1</tt>, as it's a Google
device). It's also covered <a class="reference external" href="https://developer.android.com/studio/run/device.html">here</a>.
<tt class="docutils literal">sudo udevadm control <span class="pre">--reload-rules</span> &amp;&amp; udevadm trigger</tt> reloads your udev rules.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> lsusb
<span class="gp">$</span> sudo vim /etc/udev/rules.d/51-android.rules
<span class="gp">$</span> sudo udevadm control --reload-rules <span class="o">&amp;&amp;</span> udevadm trigger
</pre></div>
<p>Lets get back to our project's path, initialize the directory to use <tt class="docutils literal">buildozer</tt>,
and edit our <tt class="docutils literal">buildozer.spec</tt> file.</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> project_path
<span class="gp">$</span> buildozer init
<span class="gp">$</span> vim buildozer.spec
</pre></div>
<p>You'll want to change your <tt class="docutils literal">buildozer.spec</tt> file for each project, focusing
on the <tt class="docutils literal">requirements</tt> tag contained within. Now you should be able to run the
following command to deploy your app on your device!</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> buildozer android debug deploy
</pre></div>


      </div><!-- /.entry-content -->

    </article>
  </section>
</div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                </address>
            </div>
        </div>
    </footer>

    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>